#!/bin/env perl
#
# Tpda3 Application Development.
#

use strict;
use warnings;
use utf8;

use Tpda3::Devel;

tpda3d_version();

unless ( scalar @ARGV ) {
    require Pod::Usage;
    Pod::Usage::pod2usage(
        {   -verbose => 1,
            -exitval => 0,
        }
    );
}

main();

sub main {
    my $opt = Tpda3::Devel::get_options();

    check_options($opt);

    Tpda3::Devel->new($opt)->process_command();
}

sub check_options {
    my $opt = shift;

    if ( defined $opt->{list} ) {
        my $cfg = Tpda3::Config->instance( { list => $opt->{list} } );
        $cfg->list_mnemonics( $opt->{list} );
        exit;
    }
}

sub tpda3d_version {

    my $ver = $Tpda3::Devel::VERSION;
    print
"Tpda3-Devel v$ver\n(C) 2010-2013 Stefan Suciu\n\n";
}

=head1 NAME

Tpda3 Application Development.

=head1 SYNOPSIS

Create a new Tpda3 application:

   tpda3d -A <app-name> -d <dbi-dsn>

Generate a new Tpda3 screen module and a screen configuration:

   tpda3d -S <scr-name> -t <table[,table]>

Update a Tpda3 screen configuration:

   tpda3d -U -c <scr-cfg>

Info:

 -l, --list                List available application configurations.
 -t, --tables              List all te tables from the database.
 -?, --help | -m, --man

=head1 DESCRIPTION

Utility program to create or extend Tpda3 application modules.

=head2  Create a Tpda3 application module

The command line parameters

   tpda3d -A <app-name> -d <dbi-dsn>

=over

=item <app-name>  is the name of the application

The distribution name will be L<< Tpda3-<app-name> >>.

=item <dbi-dsn>  a valid DBI DSN string

For Pg it looks like this:

    dbi:Pg:dbname=database;host=localhost;port=5432

For Firebird:

    dbi:Firebird:dbname=database;host=localhost;port=3050

Change B<database> to the real database name to be used.

=back

=head2 Update mode

Updates an existing application.  Create a new screen module and the
coresponding screen configuration, or update an existing screen
configuration to the current version.

Extract table informations from a database and create a basic screen
configuration file and a PerlTk screen module file.

The parameters are:

=over

=item  <app-name>     required, the name of the new application module

=item  <scr-name>     required, the name of the new screen module

=item  <table>        required, the name of the main table

=item  [scr-cfg]      optional, the name of the screen config

=back

If the screen config name is not provided then is set to lower case of
the screen name.

=head1 CONFIGURATION AND ENVIRONMENT

Requirements:

    Tpda3 v0.61.

=head1 BUGS AND LIMITATIONS

There are no known bugs in this module.

Please report problems to the author(s)

Patches are welcome.

=head1 AUTHOR

Stefan Suciu, C<< <stefan la s2i2.ro> >>

=head1 LICENCE AND COPYRIGHT

Copyright (c) 2011-2013 Stefan Suciu.

All rights reserved.

GNU General Public License
